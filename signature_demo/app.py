# -*- coding:utf-8 -*-
from flask import Flask,request,jsonify,session
from flask import render_template,session,make_response
import hmac,hashlib
from urllib.parse import urlencode, quote_plus

app = Flask(__name__)
app.secret_key="Securinets_is_making_me_tired_again_and_again"
url="https://www.securiday.me/"
def sign(params):
	signature = hmac.new(app.secret_key.encode("utf8"), params, hashlib.sha256).hexdigest()
	return signature
def isLogin():
## Just random code to simulate login test ##
	return True 


@app.route('/referral')
def referral():
	if isLogin():
		username=request.args.get("sender")
		params={"sender":username,"signature":sign(username.encode("utf8"))}
		referralLink=url+"invite?"+urlencode(params, quote_via=quote_plus)
		return jsonify({"ReferralLink":referralLink})


@app.route("/login")
def login():
	## Just To simulate a login behaviour ##
	username=request.args.get("username")
	## ....Â ##
	session["username"]=username
	return jsonify({"Result":"Login Successfully"})


@app.route('/resetPassword')
def reset():
	username=request.args.get("username")
	if username!=session["username"]:
		return jsonify({"Result":"Error You can't just reset the password of any user :("})
	email=request.args.get("email")
	params={"username":username,"signature":sign(username.encode("utf8"))}
	reset=url+"reset?"+urlencode(params, quote_via=quote_plus)
#	mail_send(email,reset)
	return jsonify({"Result":"Reset Link was sent successfully to your mail"})



if __name__ == '__main__':
	app.run(host="0.0.0.0",port=1234,debug=False)
